syntax = "proto3";

package gastrolog.v1;

option go_package = "gastrolog/api/gen/gastrolog/v1;gastrologv1";

// ConfigService provides configuration management.
service ConfigService {
  // GetConfig returns the current configuration.
  rpc GetConfig(GetConfigRequest) returns (GetConfigResponse);

  // UpdateStoreFilter updates a store's filter expression.
  rpc UpdateStoreFilter(UpdateStoreFilterRequest) returns (UpdateStoreFilterResponse);

  // ListIngesters returns all registered ingesters.
  rpc ListIngesters(ListIngestersRequest) returns (ListIngestersResponse);

  // GetIngesterStatus returns status for a specific ingester.
  rpc GetIngesterStatus(GetIngesterStatusRequest) returns (GetIngesterStatusResponse);

  // PutRotationPolicy creates or updates a rotation policy.
  rpc PutRotationPolicy(PutRotationPolicyRequest) returns (PutRotationPolicyResponse);

  // DeleteRotationPolicy removes a rotation policy.
  rpc DeleteRotationPolicy(DeleteRotationPolicyRequest) returns (DeleteRotationPolicyResponse);

  // PutStore creates or updates a store.
  rpc PutStore(PutStoreRequest) returns (PutStoreResponse);

  // DeleteStore removes a store (must be empty).
  rpc DeleteStore(DeleteStoreRequest) returns (DeleteStoreResponse);

  // PutIngester creates or updates an ingester.
  rpc PutIngester(PutIngesterRequest) returns (PutIngesterResponse);

  // DeleteIngester removes an ingester.
  rpc DeleteIngester(DeleteIngesterRequest) returns (DeleteIngesterResponse);
}

message GetConfigRequest {}

message GetConfigResponse {
  repeated StoreConfig stores = 1;
  repeated IngesterConfig ingesters = 2;
  map<string, RotationPolicyConfig> rotation_policies = 3;
}

message StoreConfig {
  string id = 1;
  string type = 2;
  string filter = 3;
  string policy = 4;
  map<string, string> params = 5;
}

message IngesterConfig {
  string id = 1;
  string type = 2;
  map<string, string> params = 3;
}

message RotationPolicyConfig {
  int64 max_bytes = 1;
  int64 max_records = 2;
  int64 max_age_seconds = 3;
}

message UpdateStoreFilterRequest {
  string store_id = 1;
  string filter = 2;
}

message UpdateStoreFilterResponse {}

message ListIngestersRequest {}

message ListIngestersResponse {
  repeated IngesterInfo ingesters = 1;
}

message IngesterInfo {
  string id = 1;
  string type = 2;
  bool running = 3;
}

message GetIngesterStatusRequest {
  string id = 1;
}

message GetIngesterStatusResponse {
  string id = 1;
  string type = 2;
  bool running = 3;
  int64 messages_ingested = 4;
  int64 errors = 5;
}

message PutRotationPolicyRequest {
  string id = 1;
  RotationPolicyConfig config = 2;
}

message PutRotationPolicyResponse {}

message DeleteRotationPolicyRequest {
  string id = 1;
}

message DeleteRotationPolicyResponse {}

message PutStoreRequest {
  StoreConfig config = 1;
}

message PutStoreResponse {}

message DeleteStoreRequest {
  string id = 1;
}

message DeleteStoreResponse {}

message PutIngesterRequest {
  IngesterConfig config = 1;
}

message PutIngesterResponse {}

message DeleteIngesterRequest {
  string id = 1;
}

message DeleteIngesterResponse {}

set dotenv-load

# Lists all available backend commands.
_default:
  @just --list

# Builds the gastrolog binary.
build:
  go build -o gastrolog ./cmd/gastrolog

# Runs the gastrolog backend with sqlite config (default).
run-sqlite:
  go run ./cmd/gastrolog server --home data

# Runs the gastrolog backend with json config.
run-json:
  go run ./cmd/gastrolog server --config-type json --home data

# Runs the gastrolog backend with in-memory config (no persistence).
run-memory:
  go run ./cmd/gastrolog server --config-type memory

alias run := run-sqlite

# Runs the gastrolog backend with full bootstrap (memory store + chatterbox).
run-bootstrap:
  go run ./cmd/gastrolog server --bootstrap --home data

# Runs the gastrolog backend with pprof server.
pprof:
  go run ./cmd/gastrolog server --pprof localhost:6060

# Embeds built frontend assets into the backend (brotli-compressed).
embed-frontend:
  rm -rf internal/frontend/dist/*
  cp -r ../frontend/dist/* internal/frontend/dist/
  go run ./cmd/compress-assets internal/frontend/dist
